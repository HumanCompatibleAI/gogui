<chapter id="analyze">
<title>Analyze Commands</title>

<para>
A GTP program is able to change the GoGui game into similar games as Go (Gomoku, Renju, Othello...). It only supports two-players games.
</para>

<para>Ruler programs can be attached from the menu <strong>Game > Rules</strong>. A ruler program can not generate moves, contrary to the programs attached from the <Strong>Program</Strong> menu.
</para>

<para>
The game results are shown at the end of the game in a dialog box. Sizing board is impossible while another game is currently attached.
</para>

<para>
It is compulsory that the Ruler program implements the extension command
<span class="command"><strong>gogui-analyze_commands</strong></span>, which allows GoGui to query
what analyze commands are supported when a new program is attached.
</para>

<programlisting>
<userinput>
requirements/format
</userinput>
</programlisting>

<section>
<title>Requirements</title>
<para>
To work with this version of GoGui, it is required that the GTP program possesses the following methods (of the format <userinput>gogui-rules_[command_name]</userinput> ):

<variablelist>

<varlistentry>
<term><userinput>game_id</userinput></term>
<listitem>
<simpara>
The response of the command is a string that specifies the game that is managed by the GTP program. It must contain only lowercase characters (example : othello).
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>board</userinput></term>
<listitem>
<simpara>
The response of the command is a board of string containing '.' for an empty intersection of the Goban, 'X' for a black stone or 'O' for a white stone. Other characters are ignored.
This command will be used to display the board in GoGui.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>board_size</userinput></term>
<listitem>
<simpara>
The response of the command is a string containing an integer that specifies the board size of the game. The board in GoGui will always be non-resizable when a Ruler Program is attached.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>legal_moves</userinput></term>
<listitem>
<simpara>
Possible move list command for the current side to move.
The command is used to determin
It needs the following syntax:
the current point list is set, if the argument is a point list (or empty);
the current point list is returned, if the argument is
<userinput>show</userinput>.
GoGui always queries the current point list first, selects the points on the
board and allows the user to edit them, then it sends the command with the
selected points as the argument.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>gfx</userinput></term>
<listitem>
<simpara>
General graphical display command.
The response contains one graphics command per line.
Graphics commands are: BLACK, CIRCLE, COLOR, INFLUENCE, LABEL, MARK, SQUARE,
TEXT, TRIANGLE, VAR, WHITE.
TEXT is followed by a text displayed on the status bar;
LABEL arguments are point text pairs;
INFLUENCE arguments are point double pairs;
COLOR arguments are a color (like in cboard) and a point list;
VAR arguments are moves (b|w point|PASS);
all other commands take a point list.
If more than one TEXT commands exist, the text will not be displayed in the
status bar, but the lines will be merged to a multi-line text and displayed in
a window.
See the <userinput>gogui-dummy-gfx</userinput> command in
<xref linkend="reference-dummy"/> for an example.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>hstring</userinput></term>
<listitem>
<simpara>
The response is a multi-line text.
It will be displayed in a window using syntax highlighting.
Lines beginning with a word followed by a colon are displayed in bold,
points and moves in blue, the strings "black" and "white" in purple,
numbers in green, and words that are completely uppercase in red.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>hpstring</userinput></term>
<listitem>
<simpara>
Combines <userinput>pstring</userinput> and <userinput>hstring</userinput>.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>none</userinput></term>
<listitem>
<simpara>
The response is not displayed.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>param</userinput></term>
<listitem>
<para>
The response to the command is a list of program parameters.
A dialog will be shown to edit the parameters.
Each line of the response must contain a key and value.
It must be possible to change a value using the same command, with the
key and new value as arguments.
No whitespaces are allowed in the keys, but underscores will be
replaced by spaces in the labels of the dialog and lowercase keys
will be capitalized.
Optionally, a line can have a type identifier for the value before the key.
Currently, the following types are supported:
<variablelist>
<varlistentry>
<term><userinput>[string]</userinput></term>
<listitem>
<simpara>
The value is displayed by an editable text field.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><userinput>[bool]</userinput></term>
<listitem>
<simpara>
The value is a boolean parameter (using "1" for
true and "0" for false) and displayed by a checkbox.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><userinput>[list/item1/item2/...]</userinput></term>
<listitem>
<simpara>
The value is selected from a list of valid items and displayed by
a combobox. No whitespaces are allowed in the items, but underscores will be
replaced by spaces in the labels of the combobox and lowercase items
will be capitalized.
</simpara>
</listitem>
</varlistentry>
</variablelist>
If no type or an unknown type is given, "string" is assumed by default.
</para>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>plist</userinput></term>
<listitem>
<simpara>
The response of the command is a list of points.
All points will be marked on the board.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>pspairs</userinput></term>
<listitem>
<simpara>
The response of the command is a list of point string pairs.
The strings are displayed as labels on the points.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>pstring</userinput></term>
<listitem>
<simpara>
The response of the command is a text, which also contains points.
Valid points contained in the text will be marked on the board.
If the text has only a single line, it will be displayed in the status line.
If it has multiple lines, a window will pop up.
If text in the window is selected, only the valid points contained in
the selected text are marked on the board.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>sboard</userinput></term>
<listitem>
<simpara>
The response of the command is a board of strings.
The strings will be displayed as labels for the points on the board.
Strings containing whitespaces have to be put in quotation marks.
The special string "" is used for no string on a point.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>string</userinput></term>
<listitem>
<simpara>
The response of the command is a text.
If the text has only a single line, it will be displayed in the status line.
If it has multiple lines, a window will pop up.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>var</userinput></term>
<listitem>
<simpara>
The response of the command is a variation of moves
containing points or passes.
The moves do not include the player color and are expected to be of alternating
color.
Text not containing points is ignored.
They will be displayed as numbered semi-transparent stones on the board.
The current color to move is assumed to move first.
Additionally the response is displayed as a string.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>varb</userinput></term>
<listitem>
<simpara>
Like <userinput>var</userinput>, but Black is assumed to move first.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>varc</userinput></term>
<listitem>
<simpara>
Like <userinput>var</userinput>, but the wildcard color in the command is
assumed to move first (see below).
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>varp</userinput></term>
<listitem>
<simpara>
Like <userinput>var</userinput>, but the command needs a point argument;
the color at that point is assumed to move first.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>varpo</userinput></term>
<listitem>
<simpara>
Like <userinput>var</userinput>, but the command needs a point argument
and the other color than the color at that point is assumed to move first.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>varw</userinput></term>
<listitem>
<simpara>
Like <userinput>var</userinput>, but White is assumed to move first.
</simpara>
</listitem>
</varlistentry>

</variablelist>
</para>
</section>

<section>
<title>Label</title>
<para>
The label to use for this command in the menu.
</para>
<para><!-- Empty paragraph to enforce space in JEditorPane --></para>
</section>

<section>
<title>Command</title>
<para>
The command to send to the Go program.
It can contain one of the following wildcards:
<variablelist>

<varlistentry>
<term><userinput>%c</userinput></term>
<listitem>
<simpara>
Will be replaced by a color, which can be selected in the analyze window;
the default is the color to play.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>%f</userinput></term>
<listitem>
<para>
Will be replaced by a file name entered by the user.
<note>
<simpara>
This wildcard is deprecated and might not be supported in the future.
It has been superseded by the more specific wildcards
<userinput>%r</userinput> and <userinput>%w</userinput>.
</simpara>
</note>
</para>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>%m</userinput></term>
<listitem>
<simpara>
Will be replaced by the color to play.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>%o</userinput></term>
<listitem>
<simpara>
This wildcard is for commands that take an optional string argument and can
be used for querying or setting a parameter of the Go program.
The command should return the current value of the parameter, if no argument
is given, and set the parameter to the argument otherwise.
The command will be run first without an argument to retrieve the current
value, which is used as default value in an input box presented to the
user.
If the user changes the value, the command will be run with the new value
as an argument to set the parameter.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>%p</userinput></term>
<listitem>
<simpara>
Will be replaced by the a point selected by the user.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>%P</userinput></term>
<listitem>
<simpara>
Will be replaced by a list of points selected by the user.
The points are selected by clicking on the board.
The last point of the list is selected either by clicking with the
<keycap>Ctrl</keycap> key pressed, double-clicking, or using the right
mouse button.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>%r</userinput></term>
<listitem>
<para>
Will be replaced by a file name for opening a file selected by the user.
If the path to the file contains spaces, it will be quoted with double quotes.
</para>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>%s</userinput></term>
<listitem>
<simpara>
Will be replaced by an argument entered by the user.
</simpara>
</listitem>
</varlistentry>

<varlistentry>
<term><userinput>%w</userinput></term>
<listitem>
<para>
Will be replaced by a file name for saving selected by the user.
If the path to the file contains spaces, it will be quoted with double quotes.
</para>
</listitem>
</varlistentry>

</variablelist>
</para>
<para>
<!-- Empty paragraph to enforce some space in JEditorPane (Java 1.5.0) -->
</para>
</section>

</chapter>
