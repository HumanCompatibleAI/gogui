<?xml version="1.0"?>
<!--
Build file for Apache Ant (http://ant.apache.org/)

$Id$
$Source$
-->

<project name="GoGui" default="all">

<property name="version" value="0.6pre3"/>

<property environment="env"/>
<property name="docbook_xsl_home" value="${env.DOCBOOK_XSL_HOME}"/>
<available property="xslAvailable" file="${docbook_xsl_home}/html/chunk.xsl"/>
<available property="commAvailable" classname="javax.comm.SerialPort"/>

<target name="all" depends="
 gmptogtp.jar,
 gogui.jar,
 gtpadapter.jar,
 gtpdummy.jar,
 gtpregress.jar,
 gtpserver.jar,
 gtpterminal.jar,
 netgtp.jar,
 sgftotex.jar,
 twogtp.jar
"/>

<target name="clean" depends="cleanBuildDir">
<delete failonerror="false" includeEmptyDirs="true">
<fileset dir="lib"
 includes="
   gmptogtp.jar,
   gogui.jar,
   gtpadapter.jar,
   gtpdummy.jar,
   gtpregress.jar,
   gtpserver.jar,
   gtpterminal.jar,
   netgtp.jar,
   sgftotex.jar,
   twogtp.jar
  "
/>
</delete>
</target>

<target name="cleanBuildDir">
<delete failonerror="false" includeEmptyDirs="true">
<fileset dir="build/config"/>
<fileset dir="build/doc"/>
<fileset dir="build/game"/>
<fileset dir="build/gmp"/>
<fileset dir="build/gmptogtp"/>
<fileset dir="build/go"/>
<fileset dir="build/gtp"/>
<fileset dir="build/gtpadapter"/>
<fileset dir="build/gtpdummy"/>
<fileset dir="build/gtpregress"/>
<fileset dir="build/gtpserver"/>
<fileset dir="build/gtpterminal"/>
<fileset dir="build/gui"/>
<fileset dir="build/images"/>
<fileset dir="build/latex"/>
<fileset dir="build/netgtp"/>
<fileset dir="build/sgf"/>
<fileset dir="build/sgftotex"/>
<fileset dir="build/twogtp"/>
<fileset dir="build/utils"/>
<fileset dir="build/version"/>
</delete>
</target>

<target name="checkCommAvailable" unless="commAvailable">
<fail>
Class javax.comm.SerialPort not found in the class path.
Please install the Java Communications API from
http://java.sun.com/products/javacomm/
</fail>
</target>

<target name="checkXslAvailable" unless="xslAvailable">
<fail>
File "${docbook_xsl_home}/html/chunk.xsl" not found.
Please install the DocBook XSL style sheets from
http://sourceforge.net/projects/docbook/
and set the environment variable DOCBOOK_XSL_HOME to the
installation directory.

</fail>
</target>

<target name="compile" depends="checkCommAvailable,version,doc">
<mkdir dir="build"/>
<javac srcdir="src" destdir="build" source="1.4" deprecation="true"
 optimize="true" listfiles="yes"/>
<copy todir="build">
<fileset dir="src" includes="images/*.png"/>
</copy>
<copy todir="build/doc">
<fileset dir="doc/html" includes="*.html"/>
</copy>
<copy todir="build/config">
<fileset dir="config" includes="analyze-commands"/>
</copy>
</target>

<target name="dist" depends="all,man">
<zip destfile="gogui-${version}.zip">
<zipfileset prefix="gogui-${version}" dir="." includes="
 README
 INSTALL
 TODO
 build.xml,
 config/analyze-commands*,
 config/gogui.desktop,
 doc/html/*.html,
 doc/html/*.css,
 doc/man/*.1,
 doc/xml/*.xml,
 doxygen/Doxyfile,
 lib/*.jar,
 src/images/*.png,
 src/overview.html,
 src/*/package.html,
 src/*/*.java,
" />
<zipfileset prefix="gogui-${version}" dir="." filemode="755" includes="
 bin/gmptogtp,
 bin/gogui,
 bin/gtpadapter,
 bin/gtpdummy,
 bin/gtpregress,
 bin/gtpserver,
 bin/gtpterminal,
 bin/netgtp,
 bin/sgftotex,
 bin/twogtp,
" />
</zip>
</target>

<target name="doc" depends="docCheckUptodate" unless="docUptodate">
<antcall target="checkXslAvailable"/>
<style basedir="doc/xml" includes="book.xml" destdir="doc/html"
 style="doc/xml/html.xsl" force="true">
<xmlcatalog>
<dtd publicId="http://docbook.sourceforge.net/release/xsl/current/html/chunk.xsl"
 location="${docbook_xsl_home}/html/chunk.xsl"/>
</xmlcatalog>
<param name="admon.graphics" expression="0"/>
<param name="admon.graphics.path" expression=""/>
<param name="chunk.quietly" expression="1"/>
<param name="chunk.section.depth" expression="0"/>
<param name="html.cleanup" expression="1"/>
<param name="html.stylesheet" expression="docbook.css"/>
<param name="make.valid.html" expression="1"/>
<param name="navig.showtitles" expression="0"/>
<param name="refentry.generate.name" expression="0"/>
<param name="refentry.generate.title" expression="1"/>
<param name="spacing.paras" expression="0"/>
<param name="toc.section.depth" expression="0"/>
<param name="use.id.as.filename" expression="1"/>
</style>
</target>

<target name="docvalidate">
<xmlvalidate file="doc/xml/book.xml"/>
</target>

<target name="docCheckUptodate">
<uptodate property="docUptodate" targetfile="doc/html/index.html">
<srcfiles dir= "doc/xml" includes="*.xml"/>
</uptodate>
</target>

<target name="gmptogtp.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gmptogtp.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="gmptogtp.GmpToGtp"/>
</manifest>
<fileset dir="build" includes="
 gmp/*.class
 gmptogtp/*.class
 gtp/Command.class
 gtp/GtpServer.class
 gtp/ReadThread.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gogui.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gogui.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="gui.GoGui"/>
</manifest>
<fileset dir="build" includes="
 config/analyze-commands
 doc/*.html
 game/*.class
 go/*.class
 gtp/*.class
 gui/*.class
 images/*.png
 latex/*.class
 sgf/*.class
 utils/*.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpadapter.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpadapter.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="gtpadapter.GtpAdapter"/>
</manifest>
<fileset dir="build" includes="
 go/*.class
 gtp/*.class
 gtpadapter/*.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpdummy.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpdummy.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="gtpdummy.GtpDummy"/>
</manifest>
<fileset dir="build" includes="
 go/Color.class
 go/Move.class
 go/Point.class
 gtp/*.class
 gtpdummy/*.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpregress.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpregress.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="gtpregress.GtpRegress"/>
</manifest>
<fileset dir="build" includes="
 go/Color.class
 go/Move.class
 go/Point.class
 gtp/*.class
 gtpregress/*.class
 utils/FileUtils.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpserver.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpserver.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="gtpserver.GtpServer"/>
</manifest>
<fileset dir="build" includes="
 gtpserver/*.class
 utils/Options.class
 utils/StreamCopy.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpterminal.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpterminal.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="gtpterminal.GtpTerminal"/>
</manifest>
<fileset dir="build" includes="
 game/*.class
 go/*.class
 gtp/*.class
 gtpterminal/*.class
 sgf/*.class
 utils/FileUtils.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="javadoc">
<javadoc sourcepath="src" destdir="javadoc" source="1.4"
 windowtitle="GoGui Source Documentation"
 overview="src/overview.html"
 packagenames="
  gmp.*,
  gmptogtp.*,
  go.*,
  gtp.*,
  gtpadapter.*,
  gtpdummy.*,
  gtpregress.*,
  gtpserver.*,
  gtpterminal.*,
  gui.*,
  latex.*,
  netgtp.*,
  sgf.*,
  sgftotex.*,
  twogtp.*,
  utils.*,
  version.*
"/>
</target>

<target name="man">
<antcall target="checkXslAvailable"/>
<style destdir="doc/man" basedir="doc/xml" includes="reference-*.xml"
 style="${docbook_xsl_home}/manpages/docbook.xsl" force="true">
<param name="chunk.quietly" expression="1"/>
</style>
</target>

<target name="netgtp.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/netgtp.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="netgtp.NetGtp"/>
</manifest>
<fileset dir="build" includes="
 netgtp/*.class
 utils/Options.class
 utils/StreamCopy.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="sgftotex.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/sgftotex.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="sgftotex.SgfToTex"/>
</manifest>
<fileset dir="build" includes="
 game/*.class
 go/*.class
 latex/*.class
 sgf/*.class
 sgftotex/*.class
 utils/FileUtils.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="twogtp.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/twogtp.jar" compress="true">
<manifest>
<attribute name="Main-Class" value="twogtp.TwoGtp"/>
</manifest>
<fileset dir="build" includes="
 game/*.class
 go/*.class
 gtp/*.class
 sgf/*.class
 twogtp/*.class
 utils/FileUtils.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="version" depends="versionCheckUptodate" unless="versionUptodate">
<copy
 file="src/version/Version.java.in"
 tofile="src/version/Version.java" overwrite="true"/>
<replace file="src/version/Version.java" token="@VERSION@" value="${version}"/>
<copy
 file="doc/xml/version.xml.in"
 tofile="doc/xml/version.xml" overwrite="true"/>
<replace file="doc/xml/version.xml" token="@VERSION@" value="${version}"/>
</target>

<target name="versionCheckUptodate">
<uptodate property="versionUptodate" targetfile="src/version/Version.java">
<srcfiles dir="." includes="build.xml,src/version/Version.java.in,doc/xml/version.xml.in"/>
</uptodate>
</target>

</project>
