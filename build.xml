<?xml version="1.0"?>
<!--
Build file for Apache Ant (http://ant.apache.org/)

$Id$
$Source$
-->

<project name="GoGui" default="all">

<tstamp/>

<property name="version" value="0.6.x"/>

<property environment="env"/>
<property name="docbook_xsl_home" value="${env.DOCBOOK_XSL_HOME}"/>
<available property="xslAvailable" file="${docbook_xsl_home}/html/chunk.xsl"/>
<available property="commAvailable" classname="javax.comm.SerialPort"/>

<target name="all" depends="
 gmptogtp.jar,
 gogui.jar,
 gtpadapter.jar,
 gtpdisplay.jar,
 gtpdummy.jar,
 gtpregress.jar,
 gtpserver.jar,
 gtpterminal.jar,
 netgtp.jar,
 sgftotex.jar,
 twogtp.jar
"/>

<target name="clean" depends="cleanBuildDir">
<delete failonerror="false" includeEmptyDirs="true">
<fileset dir="lib"
 includes="
   gmptogtp.jar,
   gogui.jar,
   gtpadapter.jar,
   gtpdisplay.jar,
   gtpdummy.jar,
   gtpregress.jar,
   gtpserver.jar,
   gtpterminal.jar,
   netgtp.jar,
   sgftotex.jar,
   twogtp.jar
  "
/>
</delete>
</target>

<target name="cleanBuildDir">
<delete failonerror="false" includeEmptyDirs="true">
<fileset dir="build/config"/>
<fileset dir="build/doc"/>
<fileset dir="build/game"/>
<fileset dir="build/gmp"/>
<fileset dir="build/gmptogtp"/>
<fileset dir="build/go"/>
<fileset dir="build/gtp"/>
<fileset dir="build/gtpadapter"/>
<fileset dir="build/gtpdisplay"/>
<fileset dir="build/gtpdummy"/>
<fileset dir="build/gtpregress"/>
<fileset dir="build/gtpserver"/>
<fileset dir="build/gtpterminal"/>
<fileset dir="build/gogui"/>
<fileset dir="build/gui"/>
<fileset dir="build/images"/>
<fileset dir="build/latex"/>
<fileset dir="build/netgtp"/>
<fileset dir="build/sgf"/>
<fileset dir="build/sgftotex"/>
<fileset dir="build/twogtp"/>
<fileset dir="build/utils"/>
<fileset dir="build/version"/>
<fileset dir="build/GoGui.app"/>
</delete>
</target>

<target name="checkCommAvailable" unless="commAvailable">
<fail>
Class javax.comm.SerialPort not found in the class path.
Please install the Java Communications API from
http://java.sun.com/products/javacomm/
</fail>
</target>

<target name="checkXslAvailable" unless="xslAvailable">
<fail>
File "${docbook_xsl_home}/html/chunk.xsl" not found.
Please install the DocBook XSL style sheets from
http://sourceforge.net/projects/docbook/
and set the environment variable DOCBOOK_XSL_HOME to the
installation directory.

</fail>
</target>

<target name="compile" depends="checkCommAvailable,version,doc">
<mkdir dir="build"/>
<javac srcdir="src" destdir="build" source="1.4" deprecation="true"
 optimize="true" listfiles="yes"/>
<copy todir="build">
<fileset dir="src" includes="images/*.png"/>
</copy>
<copy todir="build/doc">
<fileset dir="doc/html" includes="*.html *.css"/>
</copy>
<copy todir="build/config">
<fileset dir="config" includes="analyze-commands"/>
</copy>
</target>

<target name="dist" depends="all,man">
<zip destfile="gogui-${version}.zip">
<zipfileset prefix="gogui-${version}" dir="." includes="
 README
 INSTALL
 TODO
 build.xml,
 install.sh,
 config/analyze-commands*,
 config/gogui.desktop,
 config/gogui.omf,
 config/gogui.xml,
 doc/html/*.html,
 doc/html/*.css,
 doc/man/*.1,
 doc/xml/*.xml,
 doxygen/Doxyfile,
 doxygen/footer.html,
 doxygen/README,
 lib/*.jar,
 mac/packaging/GoGui.icns,
 mac/packaging/Info.plist,
 mac/packaging/PkgInfo,
 mac/src/specialmac/RegisterSpecialMacHandler.java,
 mac/src/specialmac/RegisterSpecialMacHandler.class,
 mac/src/specialmac/Listener.class,  
 sgf/openings/9x9/README,
 sgf/openings/9x9/*.sgf,
 sgf/openings/19x19/README,
 sgf/openings/19x19/*.sgf,
 src/images/*.png,
 src/overview.html,
 src/*/package.html,
 src/*/*.java,
" />
<zipfileset prefix="gogui-${version}" dir="." filemode="755" includes="
 bin/gmptogtp,
 bin/gogui,
 bin/gtpadapter,
 bin/gtpdisplay,
 bin/gtpdummy,
 bin/gtpregress,
 bin/gtpserver,
 bin/gtpterminal,
 bin/netgtp,
 bin/sgftotex,
 bin/twogtp,
" />
</zip>
</target>

<target name="doc" depends="docCheckUptodate" unless="docUptodate">
<antcall target="checkXslAvailable"/>
<exec executable="xsltproc">
<arg line="--param admon.graphics 0"/>
<arg line="--param chunk.quietly 1"/>
<arg line="--param chunk.section.depth 0"/>
<arg line="--param footer.rule 0"/>
<arg line="--param header.rule 0"/>
<arg line="--param html.cleanup 1"/>
<arg line="--stringparam html.stylesheet docbook.css"/>
<arg line="--param make.valid.html 1"/>
<arg line="--param navig.showtitles 1"/>
<arg line="--param refentry.generate.name 0"/>
<arg line="--param refentry.generate.title 1"/>
<arg line="--param spacing.paras 0"/>
<arg line="--param toc.section.depth 0"/>
<arg line="--param use.id.as.filename 1"/>
<arg line="-o doc/html/"/>
<arg line="${docbook_xsl_home}/html/chunk.xsl"/>
<arg line="doc/xml/book.xml"/>
</exec>
</target>

<target name="docvalidate">
<xmlvalidate file="doc/xml/book.xml"/>
</target>

<target name="docCheckUptodate">
<uptodate property="docUptodate" targetfile="doc/html/index.html">
<srcfiles dir= "doc/xml" includes="*.xml"/>
<srcfiles dir= "doc/html" includes="*.css"/>
</uptodate>
</target>

<target name="gmptogtp.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gmptogtp.jar">
<manifest>
<attribute name="Main-Class" value="gmptogtp.Main"/>
</manifest>
<fileset dir="build" includes="
 gmp/*.class
 gmptogtp/*.class
 go/Color.class
 go/Point.class
 gtp/*.class
 gtp/ReadThread.class
 utils/ErrorMessage.class
 utils/Options.class
 utils/ProcessUtils*.class
 utils/StreamCopy.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="GoGui.app" depends="gogui.jar"
 description="Make Mac application bundle">
<property name="appdir" value="build/GoGui.app"/>
<mkdir dir="${appdir}"/>
<mkdir dir="${appdir}/Contents"/>
<mkdir dir="${appdir}/Contents/MacOS"/>
<mkdir dir="${appdir}/Contents/Resources"/>
<mkdir dir="${appdir}/Contents/Resources/Java"/>
<copy file="/System/Library/Frameworks/JavaVM.framework/Versions/Current/Resources/MacOS/JavaApplicationStub"
  todir="${appdir}/Contents/MacOS"/>
<exec command="chmod 755 ${appdir}/Contents/MacOS/JavaApplicationStub"/>
<copy file="mac/packaging/GoGui.icns"
  todir="${appdir}/Contents/Resources"/>
<copy file="mac/packaging/Info.plist" todir="${appdir}/Contents"/>  
<copy file="mac/packaging/PkgInfo" todir="${appdir}/Contents"/>  
<copy file="lib/gogui.jar" todir="${appdir}/Contents/Resources/Java"/>
<exec command="/Developer/Tools/SetFile -a B ${appdir}"/>
</target>

<target name="gogui.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gogui.jar">
<manifest>
<attribute name="Main-Class" value="gogui.Main"/>
</manifest>
<fileset dir="build" includes="
 config/analyze-commands
 doc/*.html
 doc/*.css
 game/*.class
 go/*.class
 gtp/*.class
 gogui/*.class
 gui/*.class
 images/*.png
 latex/*.class
 sgf/*.class
 utils/*.class
 version/Version.class
"/>
<fileset dir="mac/src" includes="
 specialmac/*.class
"/>
</jar>
</target>

<target name="gtpadapter.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpadapter.jar">
<manifest>
<attribute name="Main-Class" value="gtpadapter.Main"/>
</manifest>
<fileset dir="build" includes="
 game/*.class
 go/*.class
 gtp/*.class
 gtpadapter/*.class
 sgf/*.class
 utils/ErrorMessage.class
 utils/MessageQueue.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpdisplay.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpdisplay.jar">
<manifest>
<attribute name="Main-Class" value="gtpdisplay.Main"/>
</manifest>
<fileset dir="build" includes="
 game/*.class
 go/*.class
 gui/Board*.class
 gui/BoardLabel.class
 gui/Field*.class
 gui/SimpleDialogs.class
 gtp/*.class
 gtpdisplay/*.class
 images/gogui.png
 images/wood.png
 latex/Filter.class
 sgf/Filter.class
 utils/ErrorMessage.class
 utils/GuiUtils.class
 utils/MessageQueue.class
 utils/Platform.class
 utils/Options.class
 utils/RadialGradient*.class
 utils/SquareLayout.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpdummy.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpdummy.jar">
<manifest>
<attribute name="Main-Class" value="gtpdummy.Main"/>
</manifest>
<fileset dir="build" includes="
 go/Color.class
 go/Move.class
 go/Point.class
 gtp/*.class
 gtpdummy/*.class
 utils/ErrorMessage.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpregress.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpregress.jar">
<manifest>
<attribute name="Main-Class" value="gtpregress.Main"/>
</manifest>
<fileset dir="build" includes="
 go/Color.class
 go/Move.class
 go/Point.class
 gtp/*.class
 gtpregress/*.class
 utils/ErrorMessage.class
 utils/FileUtils.class
 utils/MessageQueue.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpserver.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpserver.jar">
<manifest>
<attribute name="Main-Class" value="gtpserver.GtpServer"/>
</manifest>
<fileset dir="build" includes="
 gtpserver/*.class
 utils/ErrorMessage.class
 utils/Options.class
 utils/StreamCopy.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="gtpterminal.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/gtpterminal.jar">
<manifest>
<attribute name="Main-Class" value="gtpterminal.Main"/>
</manifest>
<fileset dir="build" includes="
 game/*.class
 go/*.class
 gtp/*.class
 gtpterminal/*.class
 sgf/*.class
 utils/ErrorMessage.class
 utils/FileUtils.class
 utils/MessageQueue.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="javadoc">
<javadoc sourcepath="src" destdir="javadoc" source="1.4"
 windowtitle="GoGui Source Documentation"
 overview="src/overview.html"
 private="true"
 linksource="true"
 packagenames="
  game.*,
  gmp.*,
  gmptogtp.*,
  go.*,
  gogui.*,
  gtp.*,
  gtpadapter.*,
  gtpdisplay.*,
  gtpdummy.*,
  gtpregress.*,
  gtpserver.*,
  gtpterminal.*,
  gui.*,
  latex.*,
  netgtp.*,
  sgf.*,
  sgftotex.*,
  twogtp.*,
  utils.*,
  version.*
"/>
</target>

<target name="man">
<antcall target="checkXslAvailable"/>
<exec executable="xsltproc">
<arg line="--param chunk.quietly 1"/>
<arg line="-o doc/man/"/>
<arg line="${docbook_xsl_home}/manpages/docbook.xsl"/>
<arg line="doc/xml/reference-gmptogtp.xml"/>
<arg line="doc/xml/reference-gogui.xml"/>
<arg line="doc/xml/reference-gtpadapter.xml"/>
<arg line="doc/xml/reference-gtpdisplay.xml"/>
<arg line="doc/xml/reference-gtpdummy.xml"/>
<arg line="doc/xml/reference-gtpregress.xml"/>
<arg line="doc/xml/reference-gtpserver.xml"/>
<arg line="doc/xml/reference-gtpterminal.xml"/>
<arg line="doc/xml/reference-netgtp.xml"/>
<arg line="doc/xml/reference-sgftotex.xml"/>
<arg line="doc/xml/reference-twogtp.xml"/>
</exec>
</target>

<target name="netgtp.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/netgtp.jar">
<manifest>
<attribute name="Main-Class" value="netgtp.NetGtp"/>
</manifest>
<fileset dir="build" includes="
 netgtp/*.class
 utils/ErrorMessage.class
 utils/Options.class
 utils/StreamCopy.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="sgftotex.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/sgftotex.jar">
<manifest>
<attribute name="Main-Class" value="sgftotex.SgfToTex"/>
</manifest>
<fileset dir="build" includes="
 game/*.class
 go/*.class
 latex/*.class
 sgf/*.class
 sgftotex/*.class
 utils/ErrorMessage.class
 utils/FileUtils.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="specialmac" depends="compile"
 description="Compile special MAC classes depending on com.apple">
<javac srcdir="mac/src" source="1.4" deprecation="true" classpath="build"
 optimize="true" listfiles="yes"
 includes="specialmac/RegisterSpecialMacHandler.java"/>
</target>

<target name="tags"
 description="Build a TAGS file for Emacs" >
<exec executable="sh">
<arg line="-c 'etags `find src -name &quot;*.java&quot;`'" />
</exec>
</target>

<target name="twogtp.jar" depends="compile">
<mkdir dir="lib"/>
<jar destfile="lib/twogtp.jar">
<manifest>
<attribute name="Main-Class" value="twogtp.Main"/>
</manifest>
<fileset dir="build" includes="
 game/*.class
 go/*.class
 gtp/*.class
 sgf/*.class
 twogtp/*.class
 utils/ErrorMessage.class
 utils/FileUtils.class
 utils/MessageQueue.class
 utils/Options.class
 utils/StringUtils.class
 version/Version.class
"/>
</jar>
</target>

<target name="version" depends="versionCheckUptodate"
 unless="versionUptodate">
<copy
 file="src/version/Version.java.in"
 tofile="src/version/Version.java" overwrite="true"/>
<replace file="src/version/Version.java" token="@VERSION@"
 value="${version}"/>
<copy
 file="doc/xml/version.xml.in"
 tofile="doc/xml/version.xml" overwrite="true"/>
<replace file="doc/xml/version.xml" token="@VERSION@" value="${version}"/>
</target>

<target name="versionCheckUptodate">
<uptodate property="versionUptodate" targetfile="src/version/Version.java">
<srcfiles dir="."
 includes="build.xml,src/version/Version.java.in,doc/xml/version.xml.in"/>
</uptodate>
</target>

</project>
